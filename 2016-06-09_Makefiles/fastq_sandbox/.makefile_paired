.SECONDEXPANSION:
	
BWA = bwa
SAMTOOLS = samtools
REF = /usr/local/ref/e_coli.fa

FASTQ_FILES = $(wildcard *R1*.fastq.gz)

default: $(FASTQ_FILES:.fastq.gz=.bam)
		
%.sai: %.fastq.gz
	$(BWA) aln $(REF) $< > $@

%.sam: %.sai $$(subst R1,R2,%.sai) %.fastq.gz $$(subst R1,R2,%.fastq.gz)
	$(BWA) sampe $(REF) $^ > $@
		
%.sam: %.sai %.fastq.gz
	$(BWA) samse $(REF) $^ > $@
	
%.bam: %.sam
	$(SAMTOOLS) view -bT $(REF) $< > $@